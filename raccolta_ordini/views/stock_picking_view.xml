<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ================================= -->
    <!-- VISTA FORM PICKING ESTESA         -->
    <!-- ================================= -->

    <record id="view_picking_form_raccolta" model="ir.ui.view">
        <field name="name">stock.picking.form.raccolta</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">

            <!-- Ribbon per picking raccolta -->
            <xpath expr="//form" position="inside">
                <widget name="web_ribbon" title="Raccolta Ordini" bg_color="bg-info"
                        attrs="{'invisible': [('raccolta_session_id', '=', False)]}"/>
            </xpath>

            <!-- Tab informazioni raccolta -->
            <xpath expr="//notebook" position="inside">
                <page string="Raccolta Ordini" name="raccolta_info"
                      attrs="{'invisible': [('raccolta_session_id', '=', False)]}">

                    <group>
                        <group string="Informazioni Sessione">
                            <field name="raccolta_session_id" readonly="1"/>
                            <field name="agent_code" readonly="1"/>
                            <field name="is_offline_picking" readonly="1"/>
                            <field name="synced_to_odoo" readonly="1"/>
                        </group>

                        <group string="Timestamp">
                            <field name="offline_created_at" readonly="1"/>
                            <field name="sync_at" readonly="1"/>
                        </group>
                    </group>

                    <!-- Configurazione DDT -->
                    <group>
                        <group string="DDT Automatico">
                            <field name="auto_create_ddt"/>
                            <field name="ddt_created" readonly="1"/>
                        </group>
                    </group>

                    <!-- Azioni -->
                    <div class="oe_clear">
                        <group>
                            <button name="action_create_ddt_manual" type="object"
                                    string="Crea DDT Manualmente" class="btn-primary"
                                    attrs="{'invisible': ['|', ('raccolta_session_id', '=', False), ('ddt_created', '=', True)]}"/>
                        </group>
                    </div>

                </page>
            </xpath>

        </field>
    </record>

    <!-- ================================= -->
    <!-- VISTA TREE PICKING ESTESA         -->
    <!-- ================================= -->

    <record id="view_picking_tree_raccolta" model="ir.ui.view">
        <field name="name">stock.picking.tree.raccolta</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">

            <!-- Aggiungi colonne raccolta -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="raccolta_session_id" string="Sessione" optional="show"/>
                <field name="agent_code" string="Agente" optional="show"/>
                <field name="is_offline_picking" string="Offline" widget="boolean" optional="show"/>
                <field name="synced_to_odoo" string="Sincronizzato" widget="boolean" optional="show"/>
            </xpath>

        </field>
    </record>

    <!-- ================================= -->
    <!-- VISTA SEARCH PICKING ESTESA       -->
    <!-- ================================= -->

    <record id="view_picking_search_raccolta" model="ir.ui.view">
        <field name="name">stock.picking.search.raccolta</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">

            <!-- Filtri raccolta -->
            <xpath expr="//search" position="inside">

                <separator/>

                <filter string="Picking Raccolta" name="raccolta_pickings"
                        domain="[('raccolta_session_id', '!=', False)]"/>

                <filter string="Creati Offline" name="offline_pickings"
                        domain="[('is_offline_picking', '=', True)]"/>

                <filter string="Non Sincronizzati" name="not_synced"
                        domain="[('synced_to_odoo', '=', False)]"/>

                <filter string="Sincronizzati" name="synced"
                        domain="[('synced_to_odoo', '=', True)]"/>

                <filter string="Con DDT Creati" name="with_ddt"
                        domain="[('ddt_created', '=', True)]"/>

                <separator/>

                <group expand="0" string="Raggruppa per Raccolta">
                    <filter string="Agente" name="group_agent"
                            context="{'group_by': 'agent_code'}"/>
                    <filter string="Sessione" name="group_session"
                            context="{'group_by': 'raccolta_session_id'}"/>
                    <filter string="Stato DDT" name="group_ddt_status"
                            context="{'group_by': 'ddt_created'}"/>
                </group>

            </xpath>

            <!-- Ricerca per agente -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="agent_code" string="Codice Agente"/>
            </xpath>

        </field>
    </record>

    <!-- ================================= -->
    <!-- AZIONI PICKING RACCOLTA          -->
    <!-- ================================= -->

    <record id="action_picking_raccolta" model="ir.actions.act_window">
        <field name="name">Picking Raccolta Ordini</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('raccolta_session_id', '!=', False)]</field>
        <field name="context">{'search_default_raccolta_pickings': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Nessun picking raccolta trovato!
            </p>
            <p>
                I picking raccolta vengono creati automaticamente
                dagli ordini raccolti dagli agenti.
            </p>
        </field>
    </record>

</odoo>